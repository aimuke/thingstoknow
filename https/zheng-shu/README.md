# 证书

SSL证书是什么，有什么作用？了解如何为你的网站获取SSL证书，并对网络流量进行加密。

互联网初期，所有网站的请求和响应都以"明文"形式传输。这意味着数据可能被窃取、偷窥，因此，传输登录凭证、信用卡号等敏感的个人信息时，用户不得不面临一些风险。

在90年代中期，网景公司（Netscape）开发了一个安全协议，用于加密网络传输中的敏感信息，这个协议被称为加密套接字协议层，也就是"SSL"。之后，又发展出传输层安全性协议，即TLS。

尽管SSL和TLS在功能和架构上有所不同，但都通过SSL证书的数字技术，为数据提供安全保护。

## 什么是SSL证书？

SSL证书是一种数字证书，可验证网站的身份并在网站与浏览器之间创建加密连接。SSL证书有时被称为"SSL/TLS证书"或简称"证书"。

SSL证书保护远程连接的身份，确保在线交互是私密的，确保除了发送者和接收者之外，没有人能够读取或修改通过安全连接共享的内容。SSL证书像护照一样验证网站所有者的身份，同时像钥匙一样通过强加密保持用户数据的安全。

## 证书如何颁发？

数字证书一般由数字证书认证机构签发，需要

* 申请者通过**非对称加密算法（RSA）** 生成一对**公钥**和**密钥**，然后把需要的申请信息（国家，域名等）连同公钥发送给 **证书认证机构（CA）**
* CA构确认无误后通过**消息摘要算法**（MD5，SHA) 生成整个申请信息的摘要签名M， 然后 把 **签名M和使用的摘要算法** 用 **CA自己的私钥** 进行加密

证书包含了

* 公钥
* 证书拥有者身份信息
* 数字证书认证机构（发行者）信息
* 发行者对这份文件的数字签名及使用的算法
* 有效期

证书的格式和验证方法普遍遵循[X.509](https://www.wikiwand.com/zh-hans/X.509) 国际标准。

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

在颁发证书之前，CA将根据行业标准核实证书请求者的信息，如站点所有权、名称、位置等。CA还会用自己的私钥对证书进行数字签名，以便客户端进行验证。为了提供此服务，大多数CA会收取一小笔年费（尽管一些[网络托管](https://www.shopify.com/zh/blog/ecommerce-hosts)和非营利组织的CA提供免费SSL证书）。

实际的SSL证书是一个小的数字文件，通常只有几千字节，安装在支持TLS的服务器上并与其他人共享。这个文件包含：

* 网站的[域名](https://www.shopify.com/zh/blog/what-is-a-domain)
* 证书颁发的组织（证书持有者）
* 颁发证书的证书颁发机构的名称
* 证书颁发机构的数字签名
* 任何相关的子域名
* 证书的发行日期和到期日期
* 公钥（注意：不共享私钥）

每当你使用浏览器连接到以"https"开头的链接，或者在浏览器地址栏看到一个绿色的锁标志时，就意味着你拥有一个通过CA颁发的SSL证书验证的安全TLS连接。点击锁标志将显示关于SSL证书、[域名](https://www.shopify.com/zh/blog/how-to-buy-a-domain)所有者和连接的附加信息。

虽然这个锁标志意味着你与该网站的连接是安全的，但这并不必然意味着该网站是安全的。也就是说，仅因为你可以安全地连接到一个网站，并不意味着它不是由不法行为者控制的。

## 什么是SSL证书颁发机构（CA）？ <a href="#id-2" id="id-2"></a>

数字证书认证机构（英语：Certificate Authority，缩写为CA），也称为电子商务认证中心、电子商务认证授权机构，是负责发放和管理数字证书的权威机构，并作为电子商务交易中受信任的第三方，承担公钥体系中公钥的合法性检验的责任。

SSL证书由称为证书颁发机构的机构颁发。CA是一个受信任的第三方组织，保证网站的身份。因为他们数量有限，广为人知，并且满足较高的准入门槛，因此而被人信任。全球有一百多个证书颁发机构，他们会接受定期审计。

### 根证书颁发机构

根[证书颁发机构](https://www.ssldragon.com/zh/blog/certificate-authority/)是 SSL 证书系统的基石，是网上安全的最高信任级别。 它的主要作用是颁发[根证书](https://www.ssldragon.com/zh/blog/root-intermediate-certificate/)，验证网站的真实性和安全性。

通过自我签名证书，根 CA 在证书层次结构中建立了信任基础。 然后，中间证书颁发机构利用这些证书向各个网站颁发证书，形成信任链。

浏览器依靠根 CA 通过签发可信证书来验证网站的合法性。 这一过程构成了安全在线通信和交易的基础。

根证书没有机构（已经是权威了）再为其做数字签名，所以都是自签证书。CA会通过 **中介证书（intermediate-certificate）** 替代根证书的去做服务器端的证书签名，确保根证书密钥绝对不可访问。

### 中间证书颁发机构

在信任链中，比根 CA 低一级的是中间 CA，它连接着受信任的根 CA 和签发给网站的证书。 顾名思义，中间 CA 充当[中间人的角色，签发中间证书](https://www.ssldragon.com/zh/blog/what-is-intermediate-certificate/)，将信任从根扩展到终端网站。

中间 CA 分散信任并增强安全性，防止根 CA 暴露。 它使用自己的[私钥签署证书，而私钥](https://www.ssldragon.com/zh/blog/ssl-private-key/)可通过中间证书中包含的[公钥](https://www.ssldragon.com/zh/blog/public-key-cryptography/)进行验证。 该签名建立了一个信任链，从根证书机构通过中间证书机构延伸到服务器。

这种层次结构可确保即使中间 CA 的私钥遭到破坏，整个链的安全性也不会受到影响，因为破坏只发生在中间层，不会影响根证书。

### 服务器（叶子）SSL 证书

从中间 CA 开始，沿着信任链往下走，我们就到了服务器 SSL 证书，这是证书信任链中最后也是最明显的一环。 该证书颁发给网站所有者，是您访问安全网站时浏览器检查的数字证书。 它可以证明服务器的身份，确保您没有连接到冒牌网站。

该安全套接字层证书包含服务器的公开密钥和拥有服务器的组织的详细信息，从而完成信任链，并通过中间 CA 将其与根 CA 绑定。

此外，服务器证书还有助于浏览器和服务器之间的加密通信，[ 保护登录凭证、信用卡详情和个人数据等 敏感信息](https://www.ssldragon.com/zh/blog/protect-sensitive-data/)不被恶意第三方截获。

拥有有效 SSL 证书的网站可在所有浏览器和系统上访问，并在搜索引擎结果页面中编入索引。



## SSL证书是如何工作的？ <a href="#id-3" id="id-3"></a>

SSL证书使用加密算法来混淆传输中的数据。这确保了浏览器和网站之间传输的任何数据都不可能被第三方读取。

通过TLS的安全通信依赖于两个证书——一个公钥和一个私钥——来创建安全连接。

当浏览器尝试连接到一个使用TLS安全的网站时，该通信是通过一个"握手"过程建立的，即来回通信仅需要几毫秒。此握手步骤包括：

1. 客户端（浏览器）连接到SSL安全的网站（服务器）。
2. 客户端要求服务器表明身份。
3. 服务器发送一份其SSL证书的副本。
4. 客户端检查SSL证书的可信度，并向服务器发出信号，如果检查通过。
5. 服务器启动一个数字签名的协议，开始SSL加密会话。
6. 加密的数据现在可以在浏览器和服务器之间自由且安全地流动。

初始的握手过程使用非对称加密，基于公钥和私钥。验证之后，客户端和服务器交换临时的私钥，仅用于本次会话。这使得加密和解密更加高效。

## 浏览器证书认证过程

在向CA 申请证书时是需要 **CA的私钥** 去对整个证书的签名摘要做非对称加密的，也就是证书是可以通过 **CA的公钥** 去解密得到**证书的签名摘要**的。\
当我们再次用 **相同的摘要算法**（证书里面有保存所使用的算法）对整个证书做签名，如果得到的签名和证书上的签名是一致的，说明这个证书是可信任的。

同理，中介证书 也是可以被这样的方式证明其可信任。这样的一整个流程称为 **信任链**（Chain of trust）。

就是我**绝对**相信你（A>B）；你**绝对**相信他（B>C）；等于我**绝对**相信他（A>C）。

以下是整个流程：

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

1. 客户端得到服务端返回的证书，通过读取得到 **服务端证书的发布机构（Issuer）**
2. 客户端去操作系统查找这个发布机构的的证书，如果是不是根证书就继续递归下去 **直到拿到根证书**。
3. 用 **根证书的公钥** 去 **解密验证** 上一层证书的**合法性**，再拿上一层证书的公钥去验证更上层证书的合法性；递归回溯。
4. 最后验证服务器端的证书是 **可信任** 的。

## SSL证书的类型 <a href="#id-4" id="id-4"></a>

要充分利用SSL，你需要选择正确的SSL证书。标准SSL证书有三种类型：

1. 域名验证（DV）证书
2. 组织验证（OV）证书
3. 扩展验证（EV）证书

不同的SSL证书服务于不同的目的，并具有不同的成本。

### 域名验证（DV）证书

**费用：**&#x30;\~99美元（约700元人民币）/年

DV SSL证书涉及最小化的自动化身份验证，仅确立证书拥有者对[域名](https://www.shopify.com/zh/blog/popular-domains)或[子域名](https://www.shopify.com/zh/blog/subdomain)的控制权。这通常通过电子邮件完成。

DV SSL证书是获得证书的最经济方式，大多数免费SSL证书都是这种类型。然而，它代表了网站安全的最低标准。DV证书适用于[博客](https://www.shopify.com/zh/blog/how-to-start-a-blog)、个人[网站](https://www.shopify.com/zh/blog/how-to-make-a-website-to-sell)、[小企业](https://www.shopify.com/zh/blog/what-is-a-small-business)或只需基本安全需求的任何网站。

### 组织验证（OV）证书

**费用：**&#x31;00\~999美元（约700\~7000元人民币）/年

OV SSL证书提供对持有者身份更强的保证。要获得OV证书，购买者必须通过九项[验证](https://www.shopify.com/zh/blog/strong-customer-authentication)检查。

这是一种中级商业证书，发行CA保证与证书相关的组织是有效并且信誉良好的。这种方法适合那些不通过其网站进行财务或电商交易的企业。

### 扩展验证（EV）证书

**费用：**&#x31;000美元以上（约7000元人民币）/年

EV SSL证书代表最高等级的身份验证，最适合公司、金融实体和[电商网站](https://www.shopify.com/zh/blog/build-a-website)。涉及十六项验证检查，包括法律身份和实际位置。

最终用户会看到浏览器栏变绿，表示达到了最高验证级别，以及锁标志后面的额外公司信息。

## 如果需要保护多个域名怎么办？ <a href="#id-7" id="id-7"></a>

单个SSL证书保护单个域名。然而，许多企业需要一种解决方案来保护多个域名或子域名。对于这些企业，SSL协议提供了两种不同的解决方案：通配符SSL证书或多域SSL证书。

### 通配符SSL证书

一些企业使用多个子域名（例如，mail.example.com，shop.example.com）来在同一网站上服务不同功能。对这些组织来说，最佳的SSL解决方案通常是通配符SSL证书。通配符SSL证书保护网站的主域名以及任何关联的子域名，降低成本并简化管理。

### 多域SSL证书MDC

虽然通配符SSL证书帮助网站所有者保护单个域名中的子域名，但多域SSL证书（MDC）可以一次性保护多个域名。可以通过"主题替代名称"（SANs）添加额外的域名到多域证书中，而无需获得额外的单域SSL证书。多域SSL证书有时被称为统一通信证书（UCC）。

## 如何获取SSL证书？ <a href="#id-9" id="id-9"></a>

获取单域或多域SSL证书并在网站上保护用户数据的流程可能很复杂。以下是操作方法：

1. **确定网站安全需求的等级。**&#x5728;DV，OV或EV SSL之间选择。如果你有多个域名或子域名，可能需要添加或替换通配符或MDC证书。审查你的组织需求和预算，并选择适当的身份验证级别。
2. **确定需要支持的域名和子域名。**&#x5982;果你只有一个，可能不需要获得通配符证书。
3. **选择证书颁发机构/供应商。**&#x5BF9;于较低端需求，你可能只需与你的[网络托管提供商](https://www.shopify.com/zh/blog/best-website-hosting-for-small-business)合作并获得免费证书。多域和EV证书将涉及与证书颁发机构的付费关系。多比较几家。
4. **生成证书签名请求（CSR）。**&#x43;SR文件包含域名和组织的信息，证书颁发机构（CA）使用该文件来生成你的SSL证书。CSR包含公钥，在申请SSL证书时必须提交给CA。
5. **从所选的SSL提供商处请求证书。**&#x8FD9;通常涉及填写网上表格和支付费用。
6. **验证所有权和其他详细信息。**&#x43;A将跟进验证你在申请中提交的信息，至少需要电子邮件验证域名所有权。
7. **获取并安装证书。**&#x8FD9;一步骤取决于你选择的CA和你的网络平台。通常，你将下载一个包含三个密钥的ZIP文件：公钥、私钥和证书颁发机构捆绑包。如果你与商业网络主机合作，你的站点的管理控制台通常会包含证书安装的工具。如果你在自己的硬件上工作，更接近操作系统和网络服务器，则遵循该环境的文档。
8. **配置其他应用程序使用证书。**&#x5982;果你打算支持服务器上其他应用程序的SSL连接（如WordPress、电子邮件等），你将需要配置它们使用你的证书和TLS协议。
9. **确认你的安全连接是否正常工作。**&#x8FDE;接到你的网站和/或其他应用程序并确保你拥有一个安全连接。点击锁标志并查看你的浏览器中显示的信息。
10. **将你的网站提交给搜索引擎。**&#x4F60;的新"https"网站不同于旧的"http"网站。如果你的用户依赖搜索引擎来找到你，你需要将你的新https网址重新提交给这些引擎进行索引。



## 证书吊销列表（CRL）和 OCSP

[证书吊销列表（CRL）](https://www.ssldragon.com/blog/crl-certificate-revocation-list/)和[在线证书状态协议（OCSP）](https://www.ssldragon.com/zh/blog/ocsp-stapling/)维护 SSL 信任链的完整性。 CRL 包含已撤销的证书，而 OCSP 则提供证书状态的实时验证。 它们共同确保只有有效的证书才能被信任，从而加强[SSL/TLS 连接的安全性。](https://www.ssldragon.com/blog/ssl-vs-tls-certificates/)

然而，依赖 CRL 和 OCSP 会带来潜在问题。 CRL 可能会变得庞大而繁琐，导致检索和处理过程中的性能问题。 同样，OCSP 查询也会带来额外的延迟，因为客户端必须与 OCSP 应答器通信，以实时验证证书状态。

此外，如果 CRL 或 OCSP 响应器不可用或响应缓慢，可能会导致建立 SSL 连接的延迟，甚至导致错误的否定，即有效证书被错误地标记为已撤销。

这些问题凸显了有效管理和提供 CRL 和 OCSP 响应器的重要性，以确保顺利和安全的运行。



## SSL 证书信任链如何工作？

以下是 SSL 证书信任链工作原理的简化步骤说明：

1. **网站所有者**[**购买 SSL 证书**](https://www.ssldragon.com/zh/ssl-certificates/)：该服务器证书可验证网站身份，确保数据传输安全。
2. **证书颁发机构（CA）颁发 SSL 证书**：他们会验证你的请求并向你提供证书。 该 CA 还受根 CA 的更高级证书的信任。
3. **根 CA 预装在网络浏览器**中：根 CA 是证书信任链中的最高级别机构。
4. **游客访问您的安全网站**：他们的浏览器启动[SSL 握手过程](https://www.ssldragon.com/zh/blog/tls-handshake/)。
5. **浏览器验证 SSL 证书**：浏览器会检查签发 CA 的数字签名，并追踪至受信任的根 CA。
6. **有效链确保安全连接**：如果链中的所有链接都有效，浏览器就会与您的网站建立安全连接。

<figure><img src="https://www.ssldragon.com/wp-content/uploads/2024/02/how-it-works-diagram-1024x558.webp" alt="SSL 信任链" height="558" width="1024"><figcaption><p>来源：维基百科<a href="https://en.wikipedia.org/wiki/Chain_of_trust#/media/File:Chain_of_trust_v2.svg">维基百科</a></p></figcaption></figure>

***

## 证书信任链的重要性 <a href="#importance" id="importance"></a>

在任何在线互动中，您的敏感信息（如信用卡详情或密码）都必须保持安全。 在这里，证书信任链变得至关重要。 它可以验证您所访问网站的真实性，确认它不是一个欺诈性网站。 如果没有这种验证，您就很容易受到[中间人攻击](https://www.ssldragon.com/zh/blog/ssl-prevent-mitm-attacks/)，恶意实体可能会拦截并滥用您的数据。



此外，证书信任链还能维护企业在网上的声誉。 如果网站没有使用有效的 SSL 证书，网络浏览器就会向用户显示安全警告。 这些警告会使潜在客户望而却步，并损害公司的声誉。

从本质上讲，数字空间的整个数据安全框架都取决于 SSL 信任链。 它可以保护隐私，确保在线交易的完整性。 如果没有这种验证机制，互联网将充满漏洞，使用户面临风险。

***

## SSL 证书链示例 <a href="#example" id="example"></a>

下面是 SSL 证书链的简化示例。 作为参考，我们使用了 PayPal 的 SSL 证书。 您可以访问 PayPal 网站，点击 URL 旁边的图标，自行检查。 在 Chrome 浏览器中，选择**连接安全** > **证书有效**。 将打开一个包含证书信息的新窗口。 要查看信任链，请访问 “**详细信息** “选项卡。 以下是您在那里能找到的东西：

1. **根证书颁发机构**：DigiCert 高保证 EV 根 CA
2. **中间证书颁发机构**：DigiCert SHA2 扩展验证服务器 CA
3. **服务器 SSL 证书**： www.paypal.com

<figure><img src="https://www.ssldragon.com/wp-content/uploads/2024/02/Paypal-Certificate-Details.webp" alt="证书详细信息 - PayPal" height="675" width="543"><figcaption></figcaption></figure>

您可以点击层次结构中的任何证书，查看签发人、主题、有效期、[签名算法](https://www.ssldragon.com/zh/blog/encryption-types-algorithms/)、扩展名等字段。 浏览器会公开显示所有证书链。 您可以在大多数浏览器和移动设备上对任何域使用相同的步骤。

\






## References

{% embed url="https://www.shopify.com/zh/blog/ssl-certificate" %}

{% embed url="https://www.ssldragon.com/zh/blog/chain-of-trust/" %}

{% embed url="https://www.cnblogs.com/aaronLinux/p/10552084.html" %}
